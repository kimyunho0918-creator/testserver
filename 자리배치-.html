<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>자리 배치 및 랜덤 선택 프로그램 (사용자 입력 모드 추가)</title>
    <style>
        /* --- CSS 스타일은 이전과 동일하게 유지됩니다. --- */
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f4f4f9;
            padding: 20px;
        }

        #seating-chart {
            display: grid;
            grid-template-columns: repeat(8, 60px); 
            gap: 10px;
            margin-bottom: 20px;
            padding: 20px;
            border: 2px solid #333;
            background-color: #fff;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            /* 초기에는 자리가 안 보이도록 설정 */
            visibility: hidden; 
        }

        .seat {
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 2px solid #555;
            border-radius: 8px;
            font-weight: bold;
            transition: all 0.2s;
            user-select: none;
            background-color: #e0f7fa; 
            cursor: pointer;
        }

        .seat.empty {
            background-color: #ffcccc; 
            border-color: #cc0000;
            cursor: default;
            color: #cc0000;
        }
        
        .seat.shuffling {
            animation: shake 0.5s infinite, flash 0.2s alternate infinite;
        }
        
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            25% { transform: translate(-1px, -2px) rotate(-0.5deg); }
            50% { transform: translate(-3px, 0px) rotate(0.5deg); }
            75% { transform: translate(1px, -1px) rotate(0deg); }
            100% { transform: translate(1px, 1px) rotate(0deg); }
        }
        
        @keyframes flash {
            from { background-color: #fff3e0; }
            to { background-color: #f7e0ff; }
        }

        .seat.selected-swap {
            border-color: #ff9800;
            background-color: #fff3e0;
            box-shadow: 0 0 10px #ff9800;
        }

        #controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            color: white;
            transition: background-color 0.3s;
        }

        #swap-button { background-color: #2196f3; }
        #swap-button:hover { background-color: #1e88e5; }

        #random-button { background-color: #4caf50; }
        #random-button:hover { background-color: #43a047; }
        #random-button:disabled { 
            background-color: #ccc;
            cursor: not-allowed;
        }

        #reset-button { background-color: #f44336; }
        #reset-button:hover { background-color: #e53935; }
        
        #input-mode-button { background-color: #ff9800; } /* 새로운 버튼 색상 */
        #input-mode-button:hover { background-color: #fb8c00; }

        #status, #result {
            margin-top: 10px;
            font-size: 1.1em;
            font-weight: bold;
            padding: 10px;
            border-radius: 5px;
            min-height: 20px;
        }

        #status { color: #3f51b5; }
        #result { color: #388e3c; background-color: #e8f5e9; }

        .row-indicator {
            grid-column: 1 / span 8;
            text-align: left;
            padding: 5px 0;
            font-weight: bold;
            color: #757575;
        }
        
        /* 사용자 입력 폼 스타일 */
        #input-container {
            border: 2px solid #ff9800;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            background-color: #fff8e1;
            display: none; /* 초기에는 숨김 */
            flex-direction: column;
            gap: 10px;
            width: 80%;
            max-width: 500px;
        }
        
        #input-container label {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        #input-container input[type="text"], #input-container input[type="number"] {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 100%;
            box-sizing: border-box;
        }
        
        #submit-input {
            background-color: #4caf50;
            margin-top: 10px;
        }
    </style>
</head>
<body>

    <h1>🔀 사용자 정의 자리 배치 프로그램</h1>

    <div id="controls">
        <button id="input-mode-button" onclick="toggleInputMode()">⚙️ 입력 모드 설정</button>
        <button id="random-button" onclick="shuffleAllSeats()" disabled>🎲 전체 자리 랜덤 재배치</button>
        <button id="swap-button" onclick="toggleSwapMode()" disabled>자리 교환 모드</button>
        <button id="reset-button" onclick="initializeSeating()">초기화 및 번호순 배치</button>
    </div>
    
    <div id="input-container">
        <h2>자리 번호 설정</h2>
        <div>
            <label for="total-end-number">1번부터 끝번호까지: (예: 30)</label>
            <input type="number" id="total-end-number" min="1" value="30">
        </div>
        <div>
            <label for="exclude-numbers">제외할 번호 입력 (쉼표로 구분): (예: 12, 17)</label>
            <input type="text" id="exclude-numbers" placeholder="쉼표(,)로 번호를 구분하여 입력하세요">
        </div>
        <button id="submit-input" onclick="applyCustomSeating()">적용 및 자리 배치</button>
    </div>

    <div id="status">설정 모드를 통해 인원수를 먼저 설정해주세요.</div>
    <div id="result"></div>

    <div id="seating-chart">
        </div>

    <script>
        // --- 설정 및 변수 선언 ---

        // 자리 배치 레이아웃 설정 (고정된 자리 배치 형태)
        const TOTAL_ROWS = 5; 
        const SEATS_PER_ROW = [8, 8, 8, 8, 8]; // 5행 모두 8칸
        const EMPTY_COLUMNS = [3, 6]; // 3열과 6열은 공석 (총 10자리 공석)
        const MAX_SEATS = TOTAL_ROWS * SEATS_PER_ROW[0] - (TOTAL_ROWS * EMPTY_COLUMNS.length); // 최대 학생 수: 30명

        // 사용자 입력 변수 (기본값 설정)
        let totalEndNumber = 30; // 1번부터 이 번호까지 번호 생성
        let excludeNumbers = []; // 제외할 번호 리스트
        
        let allSeatNumbers = [];    // 최종적으로 배치될 번호 (30명 이하)
        let seatingMap = [];        // 현재 좌석 배치를 저장하는 2차원 배열
        let swapMode = false;       
        let selectedSwapSeat = null;

        /**
         * 배열의 요소를 무작위로 섞는 Fisher-Yates 셔플 알고리즘
         */
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        /**
         * ⚙️ '입력 모드 설정' 버튼 클릭 시 입력 폼을 토글합니다.
         */
        function toggleInputMode() {
            const inputContainer = document.getElementById('input-container');
            const isVisible = inputContainer.style.display === 'flex';
            
            if (isVisible) {
                inputContainer.style.display = 'none';
                document.getElementById('input-mode-button').textContent = '⚙️ 입력 모드 설정';
            } else {
                inputContainer.style.display = 'flex';
                document.getElementById('input-mode-button').textContent = '입력 모드 닫기';
            }
        }
        
        /**
         * 📝 입력된 값을 기반으로 학생 번호를 생성하고 배치합니다.
         */
        function applyCustomSeating() {
            const endNumberInput = document.getElementById('total-end-number');
            const excludeInput = document.getElementById('exclude-numbers');
            
            const newEndNumber = parseInt(endNumberInput.value);
            const newExcludeNumbers = excludeInput.value
                .split(',')
                .map(s => parseInt(s.trim()))
                .filter(n => !isNaN(n) && n > 0);
                
            // 유효성 검사
            if (isNaN(newEndNumber) || newEndNumber < 1) {
                alert("끝 번호를 1 이상의 숫자로 정확히 입력해주세요.");
                return;
            }
            
            totalEndNumber = newEndNumber;
            excludeNumbers = newExcludeNumbers;
            
            // 번호 생성 및 배치 실행
            generateSeatNumbers();
            
            // 입력 모드 닫기
            toggleInputMode(); 
        }

        /**
         * 🔢 totalEndNumber와 excludeNumbers를 기반으로 최종 allSeatNumbers를 생성합니다.
         */
        function generateSeatNumbers() {
            allSeatNumbers = [];
            for (let i = 1; i <= totalEndNumber; i++) {
                // 제외 목록에 없으면 추가
                if (!excludeNumbers.includes(i)) {
                    allSeatNumbers.push(i);
                }
            }
            
            const currentStudentCount = allSeatNumbers.length;
            
            // 자리 수 초과 검사
            if (currentStudentCount > MAX_SEATS) {
                alert(`자리 수가 ${MAX_SEATS}석을 초과했습니다. 현재 인원: ${currentStudentCount}명. 끝 번호를 줄이거나 제외 번호를 늘려주세요.`);
                // 기본값으로 초기화
                totalEndNumber = MAX_SEATS;
                excludeNumbers = [];
                allSeatNumbers = Array.from({ length: MAX_SEATS }, (_, i) => i + 1);
            }
            
            // 최종 배치 실행
            assignSeatsToMap(allSeatNumbers);
            
            // UI 업데이트 및 버튼 활성화
            document.getElementById('seating-chart').style.visibility = 'visible';
            document.getElementById('status').textContent = `✅ 설정 완료. 총 ${allSeatNumbers.length}명의 학생이 배치되었습니다.`;
            document.getElementById('random-button').disabled = false;
            document.getElementById('swap-button').disabled = false;
        }

        /**
         * 프로그램 시작 시 실행되는 초기 함수 (현재는 입력 모드 대기 상태로 설정)
         */
        function initializeSeating() {
            // 초기 화면에서는 자리를 숨기고 입력 모드 설정 대기
            document.getElementById('seating-chart').style.visibility = 'hidden';
            document.getElementById('status').textContent = '설정 모드를 통해 인원수를 먼저 설정해주세요.';
            document.getElementById('result').textContent = '';
            document.getElementById('random-button').disabled = true;
            document.getElementById('swap-button').disabled = true;
            
            swapMode = false;
            selectedSwapSeat = null;
            document.getElementById('swap-button').textContent = '자리 교환 모드';
            document.getElementById('swap-button').classList.remove('active');
            
            // 기본값으로 1번부터 30번까지 설정 (재초기화 버튼 대비)
            totalEndNumber = 30; 
            excludeNumbers = []; 
        }
        
        /**
         * 주어진 좌석 번호 배열을 seatingMap에 순서대로 할당합니다.
         */
        function assignSeatsToMap(seatNumbers) {
            seatingMap = [];
            let seatIndex = 0;

            for (let r = 0; r < TOTAL_ROWS; r++) { 
                const row = [];
                const seatsInThisRow = SEATS_PER_ROW[r]; 

                for (let c = 0; c < seatsInThisRow; c++) { 
                    
                    // 3열과 6열은 공석
                    if (EMPTY_COLUMNS.includes(c + 1)) {
                        row.push('EMPTY');
                    } else {
                        // 학생 자리에 번호를 할당
                        if (seatIndex < seatNumbers.length) {
                            row.push(seatNumbers[seatIndex++]);
                        } else {
                            // 학생 수가 총 자리 수보다 적을 경우, 남은 자리는 비워둡니다.
                            row.push(null); 
                        }
                    }
                }
                seatingMap.push(row);
            }
            renderSeatingChart();
        }


        /**
         * seatingMap 배열을 기반으로 화면에 좌석을 그립니다.
         */
        function renderSeatingChart() {
            const chartDiv = document.getElementById('seating-chart');
            chartDiv.innerHTML = '';
            
            for (let r = 0; r < TOTAL_ROWS; r++) { 
                
                const indicator = document.createElement('div');
                indicator.className = 'row-indicator';
                indicator.textContent = `가로 ${r + 1}번 라인`;
                chartDiv.appendChild(indicator);
                
                for (let c = 0; c < SEATS_PER_ROW[r]; c++) {
                    const seatValue = seatingMap[r][c];
                    const seatDiv = document.createElement('div');
                    
                    seatDiv.className = 'seat';
                    seatDiv.dataset.row = r;
                    seatDiv.dataset.col = c;
                    
                    if (seatValue === 'EMPTY' || seatValue === null) {
                        // 공석이거나 학생 수가 부족해서 비워진 자리
                        seatDiv.textContent = seatValue === 'EMPTY' ? '공석' : '';
                        seatDiv.classList.add('empty');
                    } else if (typeof seatValue === 'number') {
                        // 학생 번호가 할당된 자리
                        seatDiv.textContent = seatValue;
                        seatDiv.addEventListener('click', handleSeatClick);
                    }
                    
                    chartDiv.appendChild(seatDiv);
                }
            }
        }

        /**
         * 자리 교환 모드를 켜거나 끕니다.
         */
        function toggleSwapMode() {
            if (document.getElementById('random-button').disabled) {
                 document.getElementById('status').textContent = '자리 배치가 먼저 완료되어야 교환할 수 있습니다.';
                 return;
            }
            // (이전 코드와 동일한 로직)
            swapMode = !swapMode;
            selectedSwapSeat = null; 
            
            const button = document.getElementById('swap-button');
            const statusDiv = document.getElementById('status');
            
            if (swapMode) {
                button.textContent = '자리 교환 모드 (활성)';
                button.classList.add('active');
                statusDiv.textContent = '자리 교환 모드: 첫 번째 자리를 선택하세요.';
            } else {
                button.textContent = '자리 교환 모드';
                button.classList.remove('active');
                statusDiv.textContent = '교환 모드가 비활성화되었습니다.';
            }
            
            document.querySelectorAll('.seat').forEach(seat => {
                seat.classList.remove('selected-swap');
            });
        }

        /**
         * 좌석 클릭 이벤트 처리 (자리 교환 모드 시에만 동작)
         */
        function handleSeatClick(event) {
            if (!swapMode) return;
            // (이전 코드와 동일한 로직)
            
            const clickedSeatDiv = event.currentTarget;
            const r = parseInt(clickedSeatDiv.dataset.row);
            const c = parseInt(clickedSeatDiv.dataset.col);
            const statusDiv = document.getElementById('status');

            if (clickedSeatDiv.classList.contains('empty')) {
                statusDiv.textContent = '비어있는 자리는 교환할 수 없습니다.';
                return;
            }

            if (selectedSwapSeat === null) {
                selectedSwapSeat = { r, c, div: clickedSeatDiv };
                clickedSeatDiv.classList.add('selected-swap');
                statusDiv.textContent = `첫 번째 자리 (${seatingMap[r][c]}번) 선택됨. 두 번째 자리를 선택하세요.`;
            } else {
                const r2 = r;
                const c2 = c;
                const seatDiv2 = clickedSeatDiv;

                if (selectedSwapSeat.r === r2 && selectedSwapSeat.c === c2) {
                    selectedSwapSeat.div.classList.remove('selected-swap');
                    selectedSwapSeat = null;
                    statusDiv.textContent = '선택이 취소되었습니다. 다시 선택해주세요.';
                    return;
                }
                
                [seatingMap[selectedSwapSeat.r][selectedSwapSeat.c], seatingMap[r2][c2]] = 
                [seatingMap[r2][c2], seatingMap[selectedSwapSeat.r][selectedSwapSeat.c]];

                selectedSwapSeat.div.textContent = seatingMap[selectedSwapSeat.r][selectedSwapSeat.c];
                seatDiv2.textContent = seatingMap[r2][c2];

                selectedSwapSeat.div.classList.remove('selected-swap');
                
                statusDiv.textContent = `자리 ${seatingMap[r2][c2]}번과 ${seatingMap[selectedSwapSeat.r][selectedSwapSeat.c]}번이 교환되었습니다.`;
                
                selectedSwapSeat = null;
            }
        }
        
        /**
         * 3. 모든 학생의 자리를 한 번에 섞어서 재배치하고 긴장감을 연출합니다.
         */
        function shuffleAllSeats() {
            // (이전 코드와 동일한 로직)
            const statusDiv = document.getElementById('status');
            const resultDiv = document.getElementById('result');
            const randomButton = document.getElementById('random-button');

            randomButton.disabled = true;
            statusDiv.textContent = '🔀 모든 자리를 섞는 중입니다... 긴장하세요!';
            resultDiv.textContent = '';
            
            document.querySelectorAll('.seat').forEach(seat => {
                if (!seat.classList.contains('empty') && seat.textContent !== '') {
                    seat.classList.add('shuffling');
                    seat.textContent = '?';
                }
            });
            
            const shuffledSeats = shuffleArray([...allSeatNumbers]); 

            setTimeout(() => {
                assignSeatsToMap(shuffledSeats);

                document.querySelectorAll('.seat').forEach(seat => {
                    seat.classList.remove('shuffling');
                });

                randomButton.disabled = false;
                statusDiv.textContent = '✅ 새로운 자리 배치가 확정되었습니다!';
                resultDiv.textContent = '🎉 모든 학생의 자리가 무작위로 재배치되었습니다!';
            }, 2000); 
        }


        // 페이지가 로드되면 프로그램 시작
        document.addEventListener('DOMContentLoaded', initializeSeating);
        
    </script>

</body>
</html>